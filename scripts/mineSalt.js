const hre = require("hardhat");
const fs = require("fs");
const inquirer = require('inquirer');

async function mineSalt() {
    const attemptsPerRun = 1_000;
    // the wallet address that you want to deploy the well from
    const wellDeployerAddress = "0x7aa056fCEf8F529E8C8e0732727F40748f49Bc1B";
    // the immutable data, encoded from the deployWell.js script
    const immutableData = "0xba51aaaa95aeefc1292515b36d86c51dc78777730000000000000000000000000000000000000000000000000000000000000002ba150c2ae0f8450d4b832beefa3338d4b5982d2600000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000001000000000000000000000000b8c77482e45f1f44de1745f52c74426c631bdd52000000000000000000000000dac17f958d2ee523a2206206994597c13d831ec7ba51aaaaa95ba1d5efb3cb1a3f50a09165315a1700000000000000000000000000000000000000000000000000000000000001e000000000000000000000000000000012000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000012000000000000000000000000000000000000000000000000000000000000006000000000000000000000000000000000000000000000000000000000000000600000000000000000000000003e99999a000000000000000000000000000000000000000000000000000000003e99999a000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000002000000000000000000000000000000000000000000000000000000000000004000000000000000000000000000000000000000000000000000000000000000a000000000000000000000000000000000000000000000000000000000000000020000000000000000000000003e99999a000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000200000000000000000000000000000000000000000000000000000000000000000000000000000000000000003e99999a00000000000000000000000000000000";
    // the prefix of the address you want to find
    const targetPrefix = "ba5"
    // the number of characters in the prefix
    const numberOfChars = targetPrefix.length;
    const saltCheckerFactory = await hre.ethers.getContractFactory("MineSalt");
    const saltChecker = await saltCheckerFactory.deploy(attemptsPerRun, wellDeployerAddress,
                                                 immutableData, targetPrefix, numberOfChars);
    for (let i = 0; i < 10_000; i++) {
        console.log(`Iteration: ${i * attemptsPerRun} through ${(i+1) * attemptsPerRun}`);
        const start = i * attemptsPerRun
        const result = await saltChecker.checkForAddress(start, { gasLimit: 5000000000 });
        if (result[0] !== hre.ethers.ZeroAddress) {
            console.log(`Predicted Well address: ${result[0]}`);
            console.log(`Prefix: ${result[1]}`);
            console.log(`Salt: ${result[2]}`);
            // write to file
            fs.writeFileSync(`./data/well.txt`, `Found Well address: ${result[0]}\nPrefix: ${result[1]}\nSalt: ${result[2]}`);
            break;
        }
    }
}

mineSalt();